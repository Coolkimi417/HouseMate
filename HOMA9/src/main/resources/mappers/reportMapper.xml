<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.homa.mappers.ReportMapper">
	<!-- 작성 -->
	 <insert id="regist">
	   insert into report(rp_num, rp_subject, rp_content, rp_reportArticle, userId, rp_passwd, rp_reportId)
	      values (Report_seq.nextval, #{rp_subject}, #{rp_content}, #{rp_reportArticle}, #{userId}, #{rp_passwd}, #{rp_reportId})
	 </insert>

	 <!-- 조회 -->
	 <select id="read" resultType="com.homa.domain.ReportVO">
	 	select rp_num, rp_subject, rp_content, rp_date,rp_readCount,userId, rp_reportId, rp_reportArticle
	   from report
	    where rp_num = #{rp_num}
	 </select>

	 <!-- 삭제 -->
	 <delete id="delete">
	  delete from
	   report
	  where rp_num = #{rp_num}
	 </delete>
	 
	
	 
	 <!-- 수정 --> 
	 <update id="update">
	  update report
	   set
	    rp_subject = #{rp_subject},
	    rp_reportId = #{rp_reportId},
	    rp_reportArticle = #{rp_reportArticle},
	    rp_content = #{rp_content},
	    rp_passwd = #{rp_passwd}
	   where rp_num = #{rp_num}  
	 </update>
	 
	<!-- 게시물갯수 -->
	<select id="listCount" resultType="int">
	<![CDATA[
		select count(rp_num)
			from Report
				where rp_num > 0
	]]>
	</select>


	<!-- 리스트 -->
	<select id="list" resultType="com.homa.domain.ReportVO"
		parameterType="com.homa.domain.SearchCriteria">
		select rp_num, rp_subject, rp_content, userId, rp_date, rp_readCount
		from (
		select rp_num, rp_subject, rp_content, userId, rp_date,
		rp_readCount,
		row_number() over(order by rp_num desc) as rNum
		from
		Report
		<include refid="search"></include>
		) mb
		where rNum between #{rowStart} and #{rowEnd}
		order by rp_num desc
	</select>

	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 't'.toString()">where rp_subject like '%' || #{keyword} || '%'</if>
			<if test="searchType == 'c'.toString()">where rp_content like '%' || #{keyword} || '%'</if>
			<if test="searchType == 'w'.toString()">where userId like '%' || #{keyword} || '%'</if>
			<if test="searchType == 'tc'.toString()">where (rp_subject like '%' || #{keyword} || '%')
				or (rp_content like '%' || #{keyword} || '%')</if>
		</if>
	</sql>
	<select id="countSearch" resultType="int">
		select count(rp_num)
		from Report
		<include refid="search"></include>
	<![CDATA[
			and rp_num > 0
	]]>
	</select>
	
	
	<!-- 조회수 증가 -->
    
    <update id="updateViewCnt">
       update report
       set rp_readCount = rp_readCount + 1
       where rp_num = #{rp_num}
    
    </update>
	
</mapper>